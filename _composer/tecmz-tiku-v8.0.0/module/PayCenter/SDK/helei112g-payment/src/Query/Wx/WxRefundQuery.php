<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Query\Wx; use Payment\Common\Weixin\Data\Query\RefundQueryData; use Payment\Common\Weixin\WxBaseStrategy; use Payment\Common\WxConfig; use Payment\Config; class WxRefundQuery extends WxBaseStrategy { protected $reqUrl = 'https://api.mch.weixin.qq.com/{debug}/pay/refundquery'; public function getBuildDataClass() { return RefundQueryData::class; } protected function retData(array $GeXSC) { goto wX7Xp; rfNrL: if ($GeXSC['return_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['return_msg'], 'channel' => Config::WX_REFUND); } goto TD4nh; TD4nh: if ($GeXSC['result_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['err_code_des'], 'channel' => Config::WX_REFUND); } goto HX1sL; HX1sL: return $this->createBackData($GeXSC); goto sDHm5; wX7Xp: if ($this->config->returnRaw) { $GeXSC['channel'] = Config::WX_REFUND; return $GeXSC; } goto rfNrL; sDHm5: } protected function createBackData(array $GeXSC) { goto FSZVQ; pwTCH: $RzrBM = array(); goto AsIRW; ucRXm: $uyhSi = bcdiv($GeXSC['refund_fee'], 100, 2); goto pwTCH; ZdUP2: $eypYa = array('is_success' => 'T', 'response' => array('amount' => $pfV4Z, 'order_no' => $GeXSC['out_trade_no'], 'transaction_id' => $GeXSC['transaction_id'], 'refund_count' => $GeXSC['refund_count'], 'refund_fee' => $uyhSi, 'refund_data' => $RzrBM, 'channel' => Config::WX_REFUND)); goto eqjcE; AsIRW: for ($l3Jim = 0; $l3Jim < $n6XsO; $l3Jim++) { $dPjdV = 'out_refund_no_' . $l3Jim; $VKq_2 = 'refund_id_' . $l3Jim; $RXAoI = 'refund_channel_' . $l3Jim; $bvkwT = 'refund_fee_' . $l3Jim; $oavUi = 'refund_status_' . $l3Jim; $BfTgY = 'refund_recv_accout_' . $l3Jim; $qqMY3 = bcdiv($bvkwT, 100, 2); $RzrBM[] = array('refund_no' => $GeXSC[$dPjdV], 'refund_id' => $GeXSC[$VKq_2], 'refund_channel' => $GeXSC[$RXAoI], 'refund_fee' => $qqMY3, 'refund_status' => strtolower($GeXSC[$oavUi]), 'recv_accout' => $GeXSC[$BfTgY]); } goto ZdUP2; FSZVQ: $n6XsO = $GeXSC['refund_count']; goto T2Wt5; eqjcE: return $eypYa; goto KIf4x; T2Wt5: $pfV4Z = bcdiv($GeXSC['total_fee'], 100, 2); goto ucRXm; KIf4x: } }
<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Query\Ali; use Payment\Common\Ali\AliBaseStrategy; use Payment\Common\Ali\Data\Query\ChargeQueryData; use Payment\Common\PayException; use Payment\Config; use Payment\Utils\ArrayUtil; class AliChargeQuery extends AliBaseStrategy { protected $method = 'alipay.trade.query'; public function getBuildDataClass() { $this->config->method = $this->method; return ChargeQueryData::class; } protected function retData(array $GeXSC) { goto CGo0G; CGo0G: $GeXSC = parent::retData($GeXSC); goto iKtqd; iKtqd: try { $BEdDh = $this->sendReq($GeXSC); } catch (PayException $knlzD) { throw $knlzD; } goto aGd9W; aGd9W: if ($this->config->returnRaw) { $BEdDh['channel'] = Config::ALI_CHARGE; return $BEdDh; } goto XaNCI; XaNCI: return $this->createBackData($BEdDh); goto OFp3r; OFp3r: } protected function createBackData(array $GeXSC) { goto Kj1Ux; Kj1Ux: if ($GeXSC['code'] !== '10000') { return array('is_success' => 'F', 'error' => $GeXSC['sub_msg'], 'channel' => Config::ALI_CHARGE); } goto aqheu; aqheu: $eypYa = array('is_success' => 'T', 'response' => array('channel' => Config::ALI_CHARGE, 'transaction_id' => $GeXSC['trade_no'], 'order_no' => $GeXSC['out_trade_no'], 'logon_id' => $GeXSC['buyer_logon_id'], 'trade_state' => $this->getTradeStatus($GeXSC['trade_status']), 'amount' => $GeXSC['total_amount'], 'receipt_amount' => $GeXSC['receipt_amount'], 'pay_amount' => ArrayUtil::get($GeXSC, 'buyer_pay_amount'), 'point_amount' => ArrayUtil::get($GeXSC, 'point_amount'), 'invoice_amount' => ArrayUtil::get($GeXSC, 'invoice_amount'), 'time_end' => ArrayUtil::get($GeXSC, 'send_pay_date'), 'store_id' => ArrayUtil::get($GeXSC, 'store_id'), 'terminal_id' => ArrayUtil::get($GeXSC, 'terminal_id'), 'store_name' => ArrayUtil::get($GeXSC, 'store_name'), 'buyer_id' => ArrayUtil::get($GeXSC, 'buyer_user_id'), 'fund_bill_list' => ArrayUtil::get($GeXSC, 'fund_bill_list', array()))); goto BFL3Q; BFL3Q: return $eypYa; goto ut3gC; ut3gC: } }
<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Query\Ali; use Payment\Common\Ali\AliBaseStrategy; use Payment\Common\Ali\Data\Query\RefundQueryData; use Payment\Common\PayException; use Payment\Config; use Payment\Utils\ArrayUtil; class AliRefundQuery extends AliBaseStrategy { protected $method = 'alipay.trade.fastpay.refund.query'; public function getBuildDataClass() { $this->config->method = $this->method; return RefundQueryData::class; } protected function retData(array $GeXSC) { goto ti2j_; eau0v: if ($this->config->returnRaw) { $BEdDh['channel'] = Config::ALI_REFUND; return $BEdDh; } goto hXlXv; aofYq: try { $BEdDh = $this->sendReq($sx3MN); } catch (PayException $knlzD) { throw $knlzD; } goto eau0v; hXlXv: return $this->createBackData($BEdDh); goto lUltw; ti2j_: $sx3MN = parent::retData($GeXSC); goto aofYq; lUltw: } protected function createBackData(array $GeXSC) { goto ynIZl; FvtHH: if (empty($GeXSC['out_trade_no'])) { return array('is_success' => 'T', 'msg' => strtolower($GeXSC['msg']), 'channel' => Config::ALI_REFUND); } goto qfPfl; FWMXY: return $eypYa; goto PToOu; qfPfl: $eypYa = array('is_success' => 'T', 'response' => array('transaction_id' => ArrayUtil::get($GeXSC, 'trade_no'), 'order_no' => ArrayUtil::get($GeXSC, 'out_trade_no'), 'refund_no' => ArrayUtil::get($GeXSC, 'out_request_no'), 'reason' => ArrayUtil::get($GeXSC, 'refund_reason'), 'amount' => ArrayUtil::get($GeXSC, 'total_amount'), 'refund_amount' => ArrayUtil::get($GeXSC, 'refund_amount'), 'channel' => Config::ALI_REFUND)); goto FWMXY; ynIZl: if ($GeXSC['code'] !== '10000') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['sub_msg'], 'channel' => Config::ALI_REFUND); } goto FvtHH; PToOu: } }
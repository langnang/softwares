<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Common\Weixin\Data; use Payment\Common\PayException; use Payment\Common\WxConfig; use Payment\Utils\ArrayUtil; class RefundData extends WxBaseData { protected function buildData() { $this->retData = array('appid' => $this->appId, 'mch_id' => $this->mchId, 'device_info' => $this->terminal_id, 'nonce_str' => $this->nonceStr, 'refund_fee_type' => $this->feeType, 'transaction_id' => $this->transaction_id, 'out_trade_no' => $this->out_trade_no, 'out_refund_no' => $this->refund_no, 'total_fee' => $this->total_fee, 'refund_fee' => $this->refund_fee, 'op_user_id' => $this->operator_id, 'refund_account' => $this->refund_account, 'notify_url' => $this->notifyUrl, 'sub_appid' => $this->sub_appid, 'sub_mch_id' => $this->sub_mch_id); $this->retData = ArrayUtil::paraFilter($this->retData); } protected function checkDataParam() { goto YYa37; ZJ9Gp: if (empty($FOaqO)) { throw new PayException('退款接口，必须提供 apiclient_key.pem 证书'); } goto TKNhd; JBSx7: if (empty($tfVOF)) { throw new PayException('退款接口，必须提供 apiclient_cert.pem 证书'); } goto ZJ9Gp; ywTVR: $uyhSi = $this->refund_fee; goto PYfTU; sKSzG: $FOaqO = $this->appKeyPem; goto JBSx7; Ft_TB: $mWdQm = $this->transaction_id; goto zVYnh; FE2uo: $this->total_fee = bcmul($pfV4Z, 100, 0); goto bk1m5; BIgkY: if (!in_array($m_VjO, array(WxConfig::REFUND_RECHARGE, WxConfig::REFUND_UNSETTLED))) { $this->refund_account = WxConfig::REFUND_UNSETTLED; } goto iAXRl; TKNhd: if (empty($Jf0Nk)) { $this->operator_id = $this->mchId; } goto t__df; EW8Iv: $m_VjO = $this->refund_account; goto MYtF8; z2kyr: if (bccomp($uyhSi, $pfV4Z, 2) === 1) { throw new PayException('退款金额不能大于订单总金额'); } goto BIgkY; v2bBC: $pfV4Z = $this->total_fee; goto ywTVR; iRNqu: if (empty($mWdQm) && empty($I7OQF)) { throw new PayException('必须提供微信交易号或商户网站唯一订单号。建议使用微信交易号'); } goto FE2uo; YYa37: $vWFlB = $this->refund_no; goto Ft_TB; iAXRl: $tfVOF = $this->appCertPem; goto sKSzG; PYfTU: $Jf0Nk = $this->operator_id; goto EW8Iv; zVYnh: $I7OQF = $this->out_trade_no; goto v2bBC; MYtF8: if (empty($vWFlB)) { throw new PayException('请设置退款单号 refund_no'); } goto iRNqu; bk1m5: $this->refund_fee = bcmul($uyhSi, 100, 0); goto z2kyr; t__df: } }
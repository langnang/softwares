<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Common; use Payment\Common\Weixin\WechatHelper; use Payment\Utils\ArrayUtil; use Payment\Utils\StrUtil; final class WxConfig extends ConfigInterface { public $appId; public $mchId; public $nonceStr; public $feeType = 'CNY'; public $timeStart; public $md5Key; public $cacertPath; public $appCertPem; public $appKeyPem; public $tradeType; public $returnUrl; public $submch; const CLOSE_URL = 'https://api.mch.weixin.qq.com/{debug}/pay/closeorder'; const SHORT_URL = 'https://api.mch.weixin.qq.com/{debug}/tools/shorturl'; const REFUND_UNSETTLED = 'REFUND_SOURCE_UNSETTLED_FUNDS'; const REFUND_RECHARGE = 'REFUND_SOURCE_RECHARGE_FUNDS'; const SANDBOX_PRE = 'sandboxnew'; protected function initConfig(array $qc0K6) { goto FBrG2; y3upu: $this->nonceStr = StrUtil::getNonceStr(); goto GdLEj; eczGc: if (key_exists('return_raw', $qc0K6)) { $this->returnRaw = filter_var($qc0K6['return_raw'], FILTER_VALIDATE_BOOLEAN); } goto FG_GG; II1nc: if (key_exists('mch_id', $qc0K6) && !empty($qc0K6['mch_id'])) { $this->mchId = $qc0K6['mch_id']; } else { throw new PayException('必须提供微信支付分配的商户号'); } goto QPeyI; hlTS0: if (!empty($qc0K6['app_cert_pem'])) { $this->appCertPem = $qc0K6['app_cert_pem']; } goto uXDbk; FBrG2: $TdX1U = dirname(dirname(__FILE__)) . DIRECTORY_SEPARATOR . 'CacertFile' . DIRECTORY_SEPARATOR; goto wkjB8; GdLEj: if (isset($qc0K6['use_sandbox']) && $qc0K6['use_sandbox'] === true) { goto lyG0y; HZ1LT: $this->signType = 'MD5'; goto m51tS; lyG0y: $this->useSandbox = true; goto HZ1LT; m51tS: $aLF23 = new WechatHelper($this, array()); goto izyFd; izyFd: $this->md5Key = $aLF23->getSandboxSignKey(); goto SlYNL; SlYNL: } else { $this->useSandbox = false; } goto V7WBp; y_N5w: if (key_exists('fee_type', $qc0K6) && in_array($qc0K6['fee_type'], array('CNY'))) { $this->feeType = $qc0K6['fee_type']; } goto LVQtu; uXDbk: if (!empty($qc0K6['app_key_pem'])) { $this->appKeyPem = $qc0K6['app_key_pem']; } goto j4pvu; wkjB8: $this->cacertPath = "{$TdX1U}wx_cacert.pem"; goto EbtTY; aMSIS: $this->timeStart = date('YmdHis', $DFazO); goto rABev; FG_GG: if (key_exists('redirect_url', $qc0K6)) { $this->returnUrl = $qc0K6['redirect_url']; } goto hlTS0; LVQtu: if (key_exists('limit_pay', $qc0K6) && !empty($qc0K6['limit_pay']) && $qc0K6['limit_pay'][0] === 'no_credit') { $this->limitPay = $qc0K6['limit_pay'][0]; } goto eczGc; EbtTY: $qc0K6 = ArrayUtil::paraFilter($qc0K6); goto jxZV5; rABev: if (key_exists('md5_key', $qc0K6) && !empty($qc0K6['md5_key'])) { $this->md5Key = $qc0K6['md5_key']; } else { throw new PayException('MD5 Key 不能为空，再微信商户后台可查看'); } goto y_N5w; QPeyI: if (key_exists('notify_url', $qc0K6) && !empty($qc0K6['notify_url'])) { $this->notifyUrl = trim($qc0K6['notify_url']); } else { throw new PayException('异步通知的url必须提供.'); } goto l8lxj; jxZV5: if (key_exists('app_id', $qc0K6) && !empty($qc0K6['app_id'])) { $this->appId = $qc0K6['app_id']; } else { throw new PayException('必须提供微信分配的公众账号ID'); } goto II1nc; V7WBp: if (isset($qc0K6['submch']) && $qc0K6['submch'] === true) { $this->submch = true; } else { $this->submch = false; } goto IF2Mb; l8lxj: $DFazO = time(); goto aMSIS; j4pvu: if (key_exists('sign_type', $qc0K6) && in_array($qc0K6['sign_type'], array('MD5', 'HMAC-SHA256'))) { $this->signType = $qc0K6['sign_type']; } else { $this->signType = 'MD5'; } goto y3upu; IF2Mb: } }
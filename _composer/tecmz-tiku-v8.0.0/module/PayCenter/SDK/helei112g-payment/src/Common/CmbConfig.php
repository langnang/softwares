<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Common; use Payment\Utils\ArrayUtil; use Payment\Utils\StrUtil; class CmbConfig extends ConfigInterface { public $version = '1.0'; public $charset = 'UTF-8'; public $merKey; public $dateTime; public $branchNo; public $merchantNo; public $returnUrl; public $signNoticeUrl; public $opPwd; public $getewayUrl; public $rsaPubKey; const MAX_EXPIRE_TIME = 30; const REQ_FILED_NAME = 'jsonRequestData'; const SUCC_TAG = 'SUC0000'; const TRADE_CODE = 'FBPK'; const NOTICE_PAY = 'BKPAYRTN'; const NOTICE_SIGN = 'BKQY'; protected function initConfig(array $qc0K6) { goto OzXU3; OzXU3: $qc0K6 = ArrayUtil::paraFilter($qc0K6); goto hw853; Y1Deg: if (key_exists('return_url', $qc0K6)) { $this->returnUrl = $qc0K6['return_url']; } goto YyMom; mjaPy: if (key_exists('sign_type', $qc0K6) && in_array($qc0K6['sign_type'], array('SHA-256'))) { $this->signType = $qc0K6['sign_type']; } else { $this->signType = 'SHA-256'; } goto Kv521; YyMom: $this->dateTime = date('YmdHis', time()); goto yv5nG; dPkOI: if (key_exists('sign_notify_url', $qc0K6) && !empty($qc0K6['sign_notify_url'])) { $this->signNoticeUrl = trim($qc0K6['sign_notify_url']); } else { throw new PayException('签约 异步通知的url必须提供.'); } goto mQmTD; Dpiu3: if (key_exists('merchant_no', $qc0K6) && !empty($qc0K6['merchant_no'])) { $this->merchantNo = trim($qc0K6['merchant_no']); } else { throw new PayException('商户号必须提供，6位数字.'); } goto op4nv; GTerO: if (key_exists('cmb_pub_key', $qc0K6) && (file_exists($qc0K6['cmb_pub_key']) || !empty($qc0K6['cmb_pub_key']))) { $this->rsaPubKey = StrUtil::getRsaKeyValue($qc0K6['cmb_pub_key'], 'public'); } else { throw new PayException('请提供招商对应的rsa公钥，可通过Helper接口获取'); } goto Y1Deg; AWmnS: if (key_exists('limit_pay', $qc0K6) && !empty($qc0K6['limit_pay']) && strtoupper($qc0K6['limit_pay'][0]) === 'A') { $this->limitPay = 'A'; } goto TIsxm; op4nv: $this->limitPay = ''; goto AWmnS; Kv521: if (isset($qc0K6['use_sandbox']) && $qc0K6['use_sandbox'] === true) { $this->useSandbox = true; } else { $this->useSandbox = false; } goto GTerO; TIsxm: if (key_exists('return_raw', $qc0K6)) { $this->returnRaw = filter_var($qc0K6['return_raw'], FILTER_VALIDATE_BOOLEAN); } goto mjaPy; hw853: if (key_exists('mer_key', $qc0K6) && !empty($qc0K6['mer_key'])) { $this->merKey = $qc0K6['mer_key']; } else { throw new PayException('Mer Key 不能为空，请前往招商一网通进行设置'); } goto U4ALs; mQmTD: if (key_exists('branch_no', $qc0K6) && !empty($qc0K6['branch_no'])) { $this->branchNo = trim($qc0K6['branch_no']); } else { throw new PayException('商户分行号必须提供，4位数字.'); } goto Dpiu3; uAaXQ: if (key_exists('notify_url', $qc0K6) && !empty($qc0K6['notify_url'])) { $this->notifyUrl = trim($qc0K6['notify_url']); } else { throw new PayException('异步通知的url必须提供.'); } goto dPkOI; U4ALs: if (key_exists('op_pwd', $qc0K6) && !empty($qc0K6['op_pwd'])) { $this->opPwd = $qc0K6['op_pwd']; } else { throw new PayException('请设置操作员登陆密码'); } goto uAaXQ; yv5nG: } }
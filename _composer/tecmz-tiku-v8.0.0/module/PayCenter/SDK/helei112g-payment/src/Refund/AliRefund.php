<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Refund; use Payment\Common\Ali\AliBaseStrategy; use Payment\Common\Ali\Data\RefundData; use Payment\Common\PayException; use Payment\Config; use Payment\Utils\ArrayUtil; class AliRefund extends AliBaseStrategy { protected $method = 'alipay.trade.refund'; public function getBuildDataClass() { $this->config->method = $this->method; return RefundData::class; } protected function retData(array $GeXSC) { goto R3nFY; aRKGN: try { $BEdDh = $this->sendReq($sx3MN); } catch (PayException $knlzD) { throw $knlzD; } goto c162X; t_ecu: return $eypYa; goto jv1Bn; pn_DH: if ($BEdDh['code'] !== '10000') { return array('is_success' => 'F', 'error' => $BEdDh['sub_msg'], 'refund_no' => $vWFlB); } goto Ip7Bi; c162X: $KqFED = \GuzzleHttp\json_decode($GeXSC['biz_content'], true); goto UGjPG; UGjPG: $vWFlB = $KqFED['out_request_no']; goto AlgEX; R3nFY: $sx3MN = parent::retData($GeXSC); goto aRKGN; AlgEX: if ($this->config->returnRaw) { goto r3DNZ; r3DNZ: $BEdDh['channel'] = Config::ALI_REFUND; goto y9WLK; y9WLK: $BEdDh['refund_no'] = $vWFlB; goto yMfa6; yMfa6: return $BEdDh; goto dBCph; dBCph: } goto pn_DH; Ip7Bi: $eypYa = array('is_success' => 'T', 'response' => array('transaction_id' => $BEdDh['trade_no'], 'order_no' => $BEdDh['out_trade_no'], 'logon_id' => $BEdDh['buyer_logon_id'], 'fund_change' => $BEdDh['fund_change'], 'refund_fee' => $BEdDh['refund_fee'], 'refund_time' => $BEdDh['gmt_refund_pay'], 'refund_detail_item_list' => ArrayUtil::get($BEdDh, 'refund_detail_item_list'), 'refund_no' => $vWFlB, 'channel' => Config::ALI_REFUND, 'buyer_id' => $BEdDh['buyer_user_id'], 'store_name' => ArrayUtil::get($BEdDh, 'store_name'))); goto t_ecu; jv1Bn: } }
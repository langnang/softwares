<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Refund; use Payment\Common\Weixin\Data\RefundData; use Payment\Common\Weixin\WxBaseStrategy; use Payment\Config; class WxRefund extends WxBaseStrategy { protected $reqUrl = 'https://api.mch.weixin.qq.com/{debug}/secapi/pay/refund'; public function getBuildDataClass() { return RefundData::class; } protected function retData(array $BEdDh) { goto v5sl6; v5sl6: if ($this->config->returnRaw) { $BEdDh['channel'] = Config::WX_REFUND; return $BEdDh; } goto iWAaZ; fxAnZ: return $this->createBackData($BEdDh); goto W84fV; zjaF2: if ($BEdDh['result_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $BEdDh['err_code_des']); } goto fxAnZ; iWAaZ: if ($BEdDh['return_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $BEdDh['return_msg']); } goto zjaF2; W84fV: } protected function createBackData(array $GeXSC) { goto TUlBF; pgfd1: return $eypYa; goto BURgm; uegp9: $eypYa = array('is_success' => 'T', 'response' => array('transaction_id' => $GeXSC['transaction_id'], 'order_no' => $GeXSC['out_trade_no'], 'refund_no' => $GeXSC['out_refund_no'], 'refund_id' => $GeXSC['refund_id'], 'refund_fee' => $bvkwT, 'refund_channel' => $GeXSC['refund_channel'], 'amount' => $lUE_H, 'channel' => Config::WX_REFUND, 'coupon_refund_fee' => bcdiv($GeXSC['coupon_refund_fee'], 100, 2), 'coupon_refund_count' => $GeXSC['coupon_refund_count'], 'cash_fee' => bcdiv($GeXSC['cash_fee'], 100, 2), 'cash_refund_fee' => bcdiv($GeXSC['cash_refund_fee'], 100, 2))); goto pgfd1; TUlBF: $lUE_H = bcdiv($GeXSC['total_fee'], 100, 2); goto POS5P; POS5P: $bvkwT = bcdiv($GeXSC['refund_fee'], 100, 2); goto uegp9; BURgm: } }
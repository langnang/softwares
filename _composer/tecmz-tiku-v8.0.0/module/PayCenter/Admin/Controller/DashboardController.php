<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\PayCenter\Admin\Controller; use Illuminate\Routing\Controller; use ModStart\Admin\Layout\AdminPage; use ModStart\Admin\Widget\DashboardItemA; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Util\TimeUtil; use ModStart\Layout\Row; use ModStart\Widget\Box; use Module\PayCenter\Biz\PayCenterBiz; use Module\PayCenter\Type\PayOrderStatus; use Module\PayCenter\Type\PayType; use Module\PayCenter\Util\PayOrderUtil; use Module\PayCenter\Util\PayUtil; class DashboardController extends Controller { public function index(AdminPage $gETpv) { goto sbOdH; HJolF: return $gETpv->pageTitle('财务概况'); goto uo9Nt; Jq90m: $gETpv->append(Box::make(new Row(function (Row $ZUrcV) { foreach (PayType::getList() as $nJFbs => $NIxlc) { goto y9GDu; kB2d_: $rkNs3 = ModelUtil::model('pay_order')->where('status', PayOrderStatus::PAYED)->where('payType', $nJFbs)->sum('feeTotal'); goto mpRhh; mpRhh: $ZUrcV->column(3, DashboardItemA::makeIconNumberTitle('fa fa-cny', sprintf('%.2f', $rkNs3), $NIxlc)); goto uS7_h; y9GDu: if (!PayUtil::isPayEnable($nJFbs)) { continue; } goto kB2d_; uS7_h: } }), '支付渠道')); goto pNLWR; sbOdH: $gETpv->append(Box::make(new Row(function (Row $ZUrcV) { $ZUrcV->column(3, DashboardItemA::makeIconNumberTitle('fa fa-cny', PayOrderUtil::totalByTimeRange(date('Y-m-d 00:00:00'), date('Y-m-d 23:59:59')), '今日交易金额')); $ZUrcV->column(3, DashboardItemA::makeIconNumberTitle('fa fa-cny', PayOrderUtil::totalByTimeRange(date('Y-m-d 00:00:00', time() - TimeUtil::PERIOD_DAY), date('Y-m-d 23:59:59', time() - TimeUtil::PERIOD_DAY)), '昨日交易金额')); $ZUrcV->column(3, DashboardItemA::makeIconNumberTitle('fa fa-cny', PayOrderUtil::total(), '总交易金额')); $ZUrcV->column(3, DashboardItemA::makeIconNumberTitle('iconfont icon-list-alt', ModelUtil::count('pay_order', array('status' => PayOrderStatus::PAYED)), '统一支付订单数')); }), '概况')); goto Jq90m; pNLWR: $gETpv->append(Box::make(new Row(function (Row $ZUrcV) { foreach (PayCenterBiz::all() as $PeuNd) { $rkNs3 = ModelUtil::model('pay_order')->where('status', PayOrderStatus::PAYED)->where('biz', $PeuNd->name())->sum('feeTotal'); $ZUrcV->column(3, DashboardItemA::makeIconNumberTitle('fa fa-cny', sprintf('%.2f', $rkNs3), $PeuNd->title())); } }), '业务汇总')); goto HJolF; uo9Nt: } }
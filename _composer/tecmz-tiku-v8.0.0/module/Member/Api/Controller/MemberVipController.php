<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Api\Controller; use Illuminate\Routing\Controller; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Exception\BizException; use ModStart\Core\Input\InputPackage; use ModStart\Core\Input\Response; use Module\Member\Auth\MemberUser; use Module\Member\Auth\MemberVip; use Module\Member\Core\MemberVipPayCenterBiz; use Module\Member\Support\MemberLoginCheck; use Module\Member\Util\MemberVipUtil; use Module\PayCenter\Support\PayCenterPerform; use Module\Vendor\Type\OrderStatus; class MemberVipController extends Controller implements MemberLoginCheck { public function info() { goto vMwTf; eu8Nb: $GeXSC['content'] = modstart_config('Member_VipContent'); goto NcpBA; nVy9x: $GeXSC['title'] = modstart_config('Member_VipTitle'); goto YvJJh; vMwTf: $GeXSC = array(); goto nVy9x; wTcuU: return Response::generateSuccessData($GeXSC); goto kremc; NcpBA: $GeXSC['vips'] = MemberVipUtil::all(); goto wTcuU; YvJJh: $GeXSC['subTitle'] = modstart_config('Member_VipSubTitle'); goto eu8Nb; kremc: } public function all() { return Response::generateSuccessData(MemberVipUtil::all()); } public function buy() { goto eB1u7; upejJ: $avIN5 = app(PayCenterPerform::class); goto FtFAJ; FtFAJ: return $avIN5->performSubmitOrder(MemberVipPayCenterBiz::NAME, $WKAF2['id'], $WKAF2['payFee'], '购买会员'); goto uxlCu; fWg80: $jFABH = MemberVipUtil::get($v0rpv); goto Q2m51; u62EG: $v0rpv = $bz1sB->getInteger('vipId'); goto JtumX; eB1u7: $bz1sB = InputPackage::buildFromInput(); goto u62EG; G97zJ: if ($ZLlSi['code']) { return Response::generateError($ZLlSi['msg']); } goto pylHE; zAoM8: $ZLlSi = $this->calc($v0rpv); goto G97zJ; Wsg13: $WKAF2 = ModelUtil::insert('member_vip_order', array('status' => OrderStatus::WAIT_PAY, 'memberUserId' => MemberUser::id(), 'vipId' => $jFABH['id'], 'payFee' => $HWmk2, 'expire' => $ZLlSi['data']['expire'], 'type' => $ZLlSi['data']['type'])); goto uNsnq; uNsnq: BizException::throwsIf('请安装 PayCenter 模块', !modstart_module_enabled('PayCenter')); goto upejJ; Q2m51: if (empty($jFABH)) { return Response::generateError('请选择会员类型'); } goto zAoM8; pylHE: $HWmk2 = $ZLlSi['data']['price']; goto uJJWr; JtumX: if (empty($v0rpv)) { return Response::generateError('请选择会员类型'); } goto fWg80; uJJWr: if ($HWmk2 < 0.01) { return Response::generateError('支付金额为空0.01'); } goto Wsg13; uxlCu: } public function calc($v0rpv = 0) { goto XkzS8; yLa0f: $jFABH = MemberVip::get(); goto gIB73; gIB73: if (empty($v0rpv)) { $v0rpv = $bz1sB->getInteger('vipId'); } goto FpwKJ; FpwKJ: if (empty($v0rpv)) { return Response::generateError('请选择会员'); } goto c5YwZ; XkzS8: $bz1sB = InputPackage::buildFromInput(); goto yLa0f; Lf1_c: if ($BEdDh['code']) { return Response::generateError($BEdDh['msg']); } goto pumbf; pumbf: return Response::generateSuccessData($BEdDh['data']); goto k3ccI; c5YwZ: $BEdDh = MemberVipUtil::calcPrice($jFABH ? $jFABH['id'] : 0, MemberUser::get('vipExpire'), $v0rpv); goto Lf1_c; k3ccI: } }
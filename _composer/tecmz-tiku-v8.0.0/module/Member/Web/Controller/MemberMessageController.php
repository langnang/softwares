<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Web\Controller; use ModStart\App\Web\Layout\WebPage; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use ModStart\Field\AbstractField; use ModStart\Field\AutoRenderedFieldValue; use ModStart\Grid\Displayer\ItemOperate; use ModStart\Grid\Grid; use ModStart\Grid\GridFilter; use ModStart\ModStart; use ModStart\Module\ModuleBaseController; use ModStart\Repository\Filter\RepositoryFilter; use ModStart\Widget\Box; use ModStart\Widget\TextAction; use Module\Member\Auth\MemberUser; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberMessageStatus; class MemberMessageController extends MemberFrameController implements MemberLoginCheck { private $api; public function __construct() { parent::__construct(); $this->api = app(\Module\Member\Api\Controller\MemberMessageController::class); } public function index(WebPage $gETpv) { goto fTcYy; qrW2L: $rWlsS->batchOperatePrepend('<button class="btn" data-batch-read-all><i class="iconfont icon-checked"></i> 全部已读</button>'); goto l36hv; vnd4k: $rWlsS->useSimple(function (AbstractField $QGYmu, $REa1I, $x1Lvn) { return AutoRenderedFieldValue::makeView('module::Member.View.pc.memberMessage.item', array('item' => $REa1I)); }); goto X12u7; O0kZI: $rWlsS->repositoryFilter(function (RepositoryFilter $qM7YH) { $qM7YH->where(array('userId' => MemberUser::id())); }); goto wgIi8; fTcYy: $rWlsS = Grid::make('member_message'); goto jeen4; wgIi8: $rWlsS->disableCUD()->disableItemOperate(); goto vnd4k; jeen4: $rWlsS->gridFilter(function (GridFilter $qM7YH) { $qM7YH->eq('status', '状态')->radio(MemberMessageStatus::class); }); goto qrW2L; X12u7: return $gETpv->pageTitle('我的消息')->view($this->viewMemberFrame)->body(new Box($rWlsS, '我的消息'))->handleGrid($rWlsS); goto h6dwC; l36hv: ModStart::scriptFile('module/Member/Web/Controller/memberMessage.js'); goto O0kZI; h6dwC: } public function delete() { return Response::sendFromGenerate($this->api->delete()); } public function read() { return Response::sendFromGenerate($this->api->read()); } public function readAll() { return Response::sendFromGenerate($this->api->readAll()); } }
<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; use Module\Vendor\Support\ResponseCodes; class ApiAuthMiddleware { public function handle($BLYQe, \Closure $d0VbK) { goto PdAlq; qJNQx: Session::flash('_memberUser', $w45m7); goto eecCP; Buu5J: if (empty($MqkYF)) { if (is_subclass_of($lH9yn, MemberLoginCheck::class)) { if (property_exists($lH9yn, 'memberLoginCheckIgnores') && is_array($lH9yn::$memberLoginCheckIgnores) && in_array($zX0Ee, $lH9yn::$memberLoginCheckIgnores)) { } else { return Response::json(ResponseCodes::LOGIN_REQUIRED, '请登录', null, modstart_web_url('login', array('redirect' => Request::currentPageUrl()))); } } } goto s87a2; PdAlq: list($lH9yn, $zX0Ee) = Request::getControllerAction(); goto ZBDk9; s87a2: Session::put('memberUserId', $MqkYF); goto qJNQx; ZBDk9: $MqkYF = intval(Session::get('memberUserId', 0)); goto e4SBo; eecCP: return $d0VbK($BLYQe); goto llYpB; YBDhY: if ($MqkYF && !$w45m7) { $MqkYF = 0; Session::forget('memberUserId'); } goto Buu5J; GbD05: if ($MqkYF) { goto JN8Ry; aJOD8: MemberUtil::processDefault($w45m7); goto spNSz; JN8Ry: $w45m7 = MemberUtil::get($MqkYF); goto aJOD8; spNSz: if ($w45m7) { switch ($w45m7['status']) { case MemberStatus::FORBIDDEN: $w45m7 = null; break; } if ($w45m7['isDeleted']) { $w45m7 = null; } } goto VRT7I; VRT7I: } goto YBDhY; e4SBo: $w45m7 = null; goto GbD05; llYpB: } }
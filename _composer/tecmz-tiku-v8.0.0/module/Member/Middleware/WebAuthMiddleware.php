<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; class WebAuthMiddleware { public function handle($BLYQe, \Closure $d0VbK) { goto pp8XS; dSJ6O: if (empty($MqkYF)) { if (is_subclass_of($lH9yn, MemberLoginCheck::class)) { if (property_exists($lH9yn, 'memberLoginCheckIgnores') && is_array($lH9yn::$memberLoginCheckIgnores) && in_array($zX0Ee, $lH9yn::$memberLoginCheckIgnores)) { } else { return Response::send(-1, null, null, modstart_web_url('login') . '?redirect=' . urlencode(Request::currentPageUrl())); } } } goto fvLNt; AZMnT: $MqkYF = intval(Session::get('memberUserId', 0)); goto aygQY; zQDzm: View::share('_memberUserId', $MqkYF); goto dSJ6O; SsTND: return $d0VbK($BLYQe); goto eC9wW; pp8XS: list($lH9yn, $zX0Ee) = Request::getControllerAction(); goto AZMnT; cHX8U: Session::flash('_memberUser', $w45m7); goto zqbZI; zqbZI: View::share('_memberUser', $w45m7); goto SsTND; Udtrp: if ($MqkYF && !$w45m7) { $MqkYF = 0; Session::forget('memberUserId'); } goto zQDzm; aygQY: $w45m7 = null; goto NX5vw; NX5vw: if ($MqkYF) { goto A5p0l; A5p0l: $w45m7 = MemberUtil::get($MqkYF); goto b0B_5; b0B_5: MemberUtil::processDefault($w45m7); goto lr75a; lr75a: if ($w45m7) { switch ($w45m7['status']) { case MemberStatus::FORBIDDEN: $w45m7 = null; break; } } goto WwGhk; WwGhk: } goto Udtrp; fvLNt: Session::put('memberUserId', $MqkYF); goto cHX8U; eC9wW: } }
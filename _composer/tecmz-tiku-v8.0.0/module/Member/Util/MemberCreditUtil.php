<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Util; use ModStart\Core\Dao\ModelUtil; class MemberCreditUtil { public static function paginateLog($MqkYF, $gETpv, $Wo30p, $InfBU = array()) { goto kAo_z; AKUns: $InfBU['order'] = array('id', 'desc'); goto br8Z_; br8Z_: return ModelUtil::paginate('member_credit_log', $gETpv, $Wo30p, $InfBU); goto LPuPG; kAo_z: $InfBU['where']['memberUserId'] = $MqkYF; goto AKUns; LPuPG: } public static function getTotal($MqkYF) { goto nBUFQ; nBUFQ: $nq5ti = ModelUtil::get('member_credit', array('memberUserId' => $MqkYF)); goto lwo7N; eg_l9: return $nq5ti['total']; goto ESMvi; lwo7N: if (empty($nq5ti)) { return 0; } goto eg_l9; ESMvi: } public static function change($MqkYF, $pvk5f, $DfuA7) { goto Wi2lM; lv6qs: if (empty($nq5ti)) { $nq5ti = ModelUtil::insert('member_credit', array('memberUserId' => $MqkYF, 'total' => 0)); } goto hby3s; Wi2lM: if (!$pvk5f) { throw new \Exception('MemberCreditUtil -> change empty'); } goto qq_PL; hby3s: if ($pvk5f < 0 && $nq5ti['total'] + $pvk5f < 0) { throw new \Exception('MemberCreditUtil -> total change to empty'); } goto v3YsD; djoOK: if ($nq5ti['total'] < 0) { throw new \Exception('MemberCreditUtil -> total empty'); } goto F27Zc; XRjbY: $nq5ti = ModelUtil::update('member_credit', array('id' => $nq5ti['id']), array('total' => $nq5ti['total'] + $pvk5f)); goto djoOK; v3YsD: ModelUtil::insert('member_credit_log', array('memberUserId' => $MqkYF, 'change' => $pvk5f, 'remark' => $DfuA7)); goto XRjbY; qq_PL: $nq5ti = ModelUtil::getWithLock('member_credit', array('memberUserId' => $MqkYF)); goto lv6qs; F27Zc: } }
<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Question\Util; use Illuminate\Support\Facades\Cache; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Util\TreeUtil; class QuestionChapterUtil { public static function clearCache() { foreach (QuestionChapterUtil::all() as $REa1I) { Cache::forget('QuestionChapter:' . $REa1I['id']); } Cache::forget('QuestionChapter:0'); } public static function get($vSByv) { return ModelUtil::get('question_chapter', $vSByv); } public static function childrenIds($oUKOQ, $vSByv) { $qb6Zc = self::all($oUKOQ); return array_merge(array($vSByv), TreeUtil::nodesChildrenIds($qb6Zc, $vSByv)); } public static function allTree($oUKOQ) { $xffUb = self::all($oUKOQ); return TreeUtil::nodesToTree($xffUb); } public static function all($oUKOQ = null) { if (is_null($oUKOQ)) { $oUKOQ = 0; } return Cache::rememberForever('QuestionChapter:' . $oUKOQ, function () use($oUKOQ) { $LJw3u = array(); if ($oUKOQ) { $LJw3u['catId'] = $oUKOQ; } return ModelUtil::all('question_chapter', $LJw3u, array('*'), array('sort', 'asc')); }); } public static function updateCount($ZG3Gn) { goto OUJCT; ost1A: foreach ($ZG3Gn as $vSByv) { goto C9JvM; mtip6: $m0MLE = self::allTree($NuYRV['catId']); goto fiBn_; oNeSI: if (empty($NuYRV)) { continue; } goto mtip6; wi2Om: foreach ($xM1vS as $REa1I) { goto e8ZdE; e8ZdE: $Da1nS = TreeUtil::treeNodeChildrenIds($m0MLE, $REa1I['id']); goto v3dnD; cJ7RW: ModelUtil::update('question_chapter', $REa1I['id'], array('questionCount' => $YZuXk)); goto KblWa; v3dnD: if (empty($Da1nS)) { $YZuXk = 0; } else { $YZuXk = ModelUtil::model('question')->where(array('parentId' => 0))->whereIn('chapterId', $Da1nS)->count(); } goto cJ7RW; KblWa: } goto utby4; fiBn_: $xM1vS = TreeUtil::treeChain($m0MLE, $vSByv); goto wi2Om; C9JvM: $NuYRV = self::get($vSByv); goto oNeSI; utby4: } goto v02z4; VDbrn: $ZG3Gn = array_unique($ZG3Gn); goto QxOJ9; QxOJ9: if (empty($ZG3Gn)) { return; } goto ost1A; OUJCT: if (!is_array($ZG3Gn)) { $ZG3Gn = array($ZG3Gn); } goto VDbrn; v02z4: self::clearCache(); goto MvXZT; MvXZT: } }
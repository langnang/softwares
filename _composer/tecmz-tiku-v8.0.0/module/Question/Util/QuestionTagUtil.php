<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Question\Util; use Illuminate\Support\Facades\Cache; use ModStart\Core\Dao\ModelUtil; class QuestionTagUtil { const QUESTION_CACHE_PREFIX = 'question:'; public static function clearCache() { goto xdxGt; xdxGt: Cache::forget(self::QUESTION_CACHE_PREFIX . ':questionTag'); goto hY3z0; yqAo8: foreach (QuestionCatUtil::all() as $REa1I) { Cache::forget(self::QUESTION_CACHE_PREFIX . ':questionTag:' . $REa1I['id']); Cache::forget(self::QUESTION_CACHE_PREFIX . ':questionTagGroup:' . $REa1I['id']); } goto UoNIE; hY3z0: Cache::forget(self::QUESTION_CACHE_PREFIX . ':questionTagGroup'); goto yqAo8; UoNIE: } public static function all() { return Cache::rememberForever(self::QUESTION_CACHE_PREFIX . ':questionTag', function () { return ModelUtil::all('question_tag', array(), array('*')); }); } public static function group() { return Cache::rememberForever(self::QUESTION_CACHE_PREFIX . ':questionTagGroup', function () { return ModelUtil::all('question_tag_group', array(), array('*'), array('sort', 'asc')); }); } public static function groupTagMap() { goto scawk; ockO3: return $TbleL; goto XGU_J; Ru1fV: foreach (self::all() as $umqi1) { $TbleL[$umqi1['id']] = $umqi1['groupId']; } goto ockO3; scawk: $TbleL = array(); goto Ru1fV; XGU_J: } public static function listByIds($Da1nS) { if (empty($Da1nS)) { return array(); } return ModelUtil::model('question_tag')->whereIn('id', $Da1nS)->get()->toArray(); } public static function getMap() { goto gxWJD; ZUba2: return $TbleL; goto jIx88; gxWJD: $L8u30 = self::all(); goto zG8yw; zG8yw: $TbleL = array(); goto LuPPR; LuPPR: foreach ($L8u30 as $caCQe) { $TbleL[$caCQe['id']] = $caCQe; } goto ZUba2; jIx88: } public static function listTagsWithCache($oUKOQ, $acWOo = 30) { return Cache::remember(self::QUESTION_CACHE_PREFIX . ':questionTag:' . $oUKOQ, $acWOo, function () use($oUKOQ) { return ModelUtil::all('question_tag', array('catId' => $oUKOQ)); }); } public static function listTagGroupsWithCache($oUKOQ, $acWOo = 30) { return Cache::remember(self::QUESTION_CACHE_PREFIX . ':questionTagGroup:' . $oUKOQ, $acWOo, function () use($oUKOQ) { return ModelUtil::all('question_tag_group', array('catId' => $oUKOQ), array('*'), array('sort', 'asc')); }); } public static function groupTags($oUKOQ) { goto H3cvj; ZwXr4: $U9Z2D = array(); goto xN2ZN; xN2ZN: foreach ($hIk3A as &$ykA_u) { goto b_cQI; ACncu: $RLvq6['groupTags'] = $wvdra; goto BKNed; KTctJ: $RLvq6['groupId'] = $ykA_u['id']; goto mmBRa; TU5_u: $wvdra = array(); goto IATdb; b_cQI: $RLvq6 = array(); goto KTctJ; IATdb: foreach ($L8u30 as &$caCQe) { if ($caCQe['groupId'] == $ykA_u['id']) { $wvdra[] = array('id' => $caCQe['id'], 'title' => $caCQe['title']); } } goto ACncu; mmBRa: $RLvq6['groupTitle'] = $ykA_u['title']; goto TU5_u; BKNed: $U9Z2D[] = $RLvq6; goto L2jdb; L2jdb: } goto YqJDV; YqJDV: return $U9Z2D; goto wD6LR; H3cvj: $L8u30 = self::listTagsWithCache($oUKOQ); goto n0IfR; n0IfR: $hIk3A = self::listTagGroupsWithCache($oUKOQ); goto ZwXr4; wD6LR: } }
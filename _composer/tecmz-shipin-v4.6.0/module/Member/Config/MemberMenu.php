<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Config; use Illuminate\Support\Str; class MemberMenu { private static $menu = array(); public static function register($CCrc9) { self::$menu[] = $CCrc9; } public static function get() { goto ZCBvc; ZCBvc: $CCrc9 = array(); goto OZyCv; OZyCv: foreach (self::$menu as $qlKQK) { if ($qlKQK instanceof \Closure) { $qlKQK = call_user_func($qlKQK); } $CCrc9 = array_merge($CCrc9, $qlKQK); } goto ZmFIF; OSGCv: return $CCrc9; goto dQBdT; ZmFIF: $CCrc9 = self::mergeMenu($CCrc9); goto OSGCv; dQBdT: } private static function sort() { static $jYlxW = 1000; return $jYlxW++; } private static function mergeMenu($CCrc9, $O5e4c = '', $EgFVw = 1, $XM5aD = null) { goto JvDoq; JvDoq: if (empty($CCrc9)) { return array(); } goto n2zCQ; PFY5c: return $KwRXA; goto v7aTz; n2zCQ: $KwRXA = array(); goto C16ic; C16ic: foreach ($CCrc9 as $qlKQK) { goto jb5fw; ax9r0: if (isset($qlKQK['icon'])) { if (preg_match('/^[a-zA-Z0-9\\-]+$/', $qlKQK['icon'])) { $qlKQK['icon'] = "<i class='icon iconfont icon-{$qlKQK['icon']}'></i>"; } } goto hhMsa; jb5fw: if (empty($qlKQK)) { continue; } goto IQ0U5; Xw7Wf: if (!isset($qlKQK['sort'])) { $qlKQK['sort'] = self::sort(); } goto v9jUT; kLe9Q: unset($KwRXA[$hBBDL]['children']); goto IjcyV; IjcyV: if (!empty($qlKQK['children'])) { $KwRXA = array_merge($KwRXA, self::mergeMenu($qlKQK['children'], $hBBDL . '^^', $EgFVw + 1, $XM5aD)); } goto x_Kd5; IQ0U5: if ($XM5aD) { if (!call_user_func($XM5aD, $qlKQK)) { continue; } } goto Xw7Wf; hhMsa: if (!isset($KwRXA[$hBBDL])) { $KwRXA[$hBBDL] = $qlKQK; } goto kLe9Q; v9jUT: if (1 == $EgFVw) { $hBBDL = $O5e4c . $qlKQK['title'] . '^' . $qlKQK['icon'] . '^' . $qlKQK['sort']; } else { $hBBDL = $O5e4c . $qlKQK['title']; } goto ax9r0; x_Kd5: } goto e9JYc; e9JYc: if ($EgFVw == 1) { uasort($KwRXA, function ($PN01a, $pXhxi) { return $PN01a['sort'] - $pXhxi['sort']; }); return self::mergeMenuTree($KwRXA); } goto PFY5c; v7aTz: } private static function mergeMenuTree($cd49C, $O5e4c = '') { goto C8leL; UO81S: return $cxHH0; goto BTiAu; ZY8z8: foreach ($cd49C as $hBBDL => $p4EDY) { goto r5PrK; J3znG: if (empty($qlKQK['children']) && empty($qlKQK['url'])) { continue; } goto aImCU; ncH0J: $qlKQK = $p4EDY; goto frmjt; RBI4j: $Ojuum = explode('^^', $hBBDL); goto yeYCq; YASNx: if (empty($qlKQK['children'])) { unset($qlKQK['children']); } goto J3znG; aImCU: $cxHH0[] = $qlKQK; goto oUOnS; frmjt: $qlKQK['children'] = self::mergeMenuTree($cd49C, $hBBDL . '^^'); goto YASNx; r5PrK: if ($hBBDL === $O5e4c) { continue; } goto RBI4j; yeYCq: if ($O5e4c) { if (!Str::startsWith($hBBDL, $O5e4c)) { continue; } if (count(explode('^^', $O5e4c)) !== count(explode('^^', $hBBDL))) { continue; } } else { if (1 != count($Ojuum)) { continue; } } goto ncH0J; oUOnS: } goto UO81S; C8leL: $cxHH0 = array(); goto ZY8z8; BTiAu: } }
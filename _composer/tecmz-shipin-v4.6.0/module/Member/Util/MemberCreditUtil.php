<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Util; use ModStart\Core\Dao\ModelUtil; class MemberCreditUtil { public static function paginateLog($XK7hT, $H1G2d, $HugPs, $eMb8v = array()) { goto bdt2Q; Ss3bK: $eMb8v['order'] = array('id', 'desc'); goto lBmgd; bdt2Q: $eMb8v['where']['memberUserId'] = $XK7hT; goto Ss3bK; lBmgd: return ModelUtil::paginate('member_credit_log', $H1G2d, $HugPs, $eMb8v); goto lddAs; lddAs: } public static function getTotal($XK7hT) { goto V2eKR; knhYA: if (empty($bgpWq)) { return 0; } goto v34Gz; v34Gz: return $bgpWq['total']; goto uCJ2j; V2eKR: $bgpWq = ModelUtil::get('member_credit', array('memberUserId' => $XK7hT)); goto knhYA; uCJ2j: } public static function change($XK7hT, $Ek1oC, $XYq5S) { goto i3GGU; WmUy5: $bgpWq = ModelUtil::update('member_credit', array('id' => $bgpWq['id']), array('total' => $bgpWq['total'] + $Ek1oC)); goto brrl2; V3dN7: if ($Ek1oC < 0 && $bgpWq['total'] + $Ek1oC < 0) { throw new \Exception('MemberCreditUtil -> total change to empty'); } goto zhq5X; K7ixX: if (empty($bgpWq)) { $bgpWq = ModelUtil::insert('member_credit', array('memberUserId' => $XK7hT, 'total' => 0)); } goto V3dN7; brrl2: if ($bgpWq['total'] < 0) { throw new \Exception('MemberCreditUtil -> total empty'); } goto siPFB; FaoHt: $bgpWq = ModelUtil::getWithLock('member_credit', array('memberUserId' => $XK7hT)); goto K7ixX; i3GGU: if (!$Ek1oC) { throw new \Exception('MemberCreditUtil -> change empty'); } goto FaoHt; zhq5X: ModelUtil::insert('member_credit_log', array('memberUserId' => $XK7hT, 'change' => $Ek1oC, 'remark' => $XYq5S)); goto WmUy5; siPFB: } }
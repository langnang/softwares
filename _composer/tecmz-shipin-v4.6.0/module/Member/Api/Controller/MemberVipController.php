<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Api\Controller; use Illuminate\Routing\Controller; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Exception\BizException; use ModStart\Core\Input\InputPackage; use ModStart\Core\Input\Response; use Module\Member\Auth\MemberUser; use Module\Member\Auth\MemberVip; use Module\Member\Core\MemberVipPayCenterBiz; use Module\Member\Support\MemberLoginCheck; use Module\Member\Util\MemberVipUtil; use Module\PayCenter\Support\PayCenterPerform; use Module\Vendor\Type\OrderStatus; class MemberVipController extends Controller implements MemberLoginCheck { public function all() { return Response::generateSuccessData(MemberVipUtil::all()); } public function buy() { goto h7wRh; eBtDf: $cYTj3 = $nIp2z->getInteger('vipId'); goto CrdfN; nMxey: $U6aGY = $this->calc($cYTj3); goto deeJQ; nhMQE: if (empty($o1JLD)) { return Response::generateError('请选择会员类型'); } goto nMxey; YBpVR: $fpmnD = app(PayCenterPerform::class); goto MTjX8; MTjX8: return $fpmnD->performSubmitOrder(MemberVipPayCenterBiz::NAME, $iVW5v['id'], $iVW5v['payFee'], '购买会员'); goto eOSei; YK6lX: if ($WRPnK < 0.01) { return Response::generateError('支付金额为空0.01'); } goto Gra_C; h7wRh: $nIp2z = InputPackage::buildFromInput(); goto eBtDf; CrdfN: if (empty($cYTj3)) { return Response::generateError('请选择会员类型'); } goto lPxOV; Gra_C: $iVW5v = ModelUtil::insert('member_vip_order', array('status' => OrderStatus::WAIT_PAY, 'memberUserId' => MemberUser::id(), 'vipId' => $o1JLD['id'], 'payFee' => $WRPnK, 'expire' => $U6aGY['data']['expire'], 'type' => $U6aGY['data']['type'])); goto u9nbt; lPxOV: $o1JLD = MemberVipUtil::get($cYTj3); goto nhMQE; u9nbt: BizException::throwsIf('请安装 PayCenter 模块', !modstart_module_enabled('PayCenter')); goto YBpVR; imurD: $WRPnK = $U6aGY['data']['price']; goto YK6lX; deeJQ: if ($U6aGY['code']) { return Response::generateError($U6aGY['msg']); } goto imurD; eOSei: } public function calc($cYTj3 = 0) { goto h_jbO; wHwZE: if (empty($cYTj3)) { $cYTj3 = $nIp2z->getInteger('vipId'); } goto c06yG; xYHF4: $ULXwZ = MemberVipUtil::calcPrice($o1JLD ? $o1JLD['id'] : 0, MemberUser::get('vipExpire'), $cYTj3); goto brYPT; brYPT: if ($ULXwZ['code']) { return Response::generateError($ULXwZ['msg']); } goto DJxkc; DJxkc: return Response::generateSuccessData($ULXwZ['data']); goto L2dES; c06yG: if (empty($cYTj3)) { return Response::generateError('请选择会员'); } goto xYHF4; h_jbO: $nIp2z = InputPackage::buildFromInput(); goto G8Cu9; G8Cu9: $o1JLD = MemberVip::get(); goto wHwZE; L2dES: } }
<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; class WebAuthMiddleware { public function handle($fn4DR, \Closure $zBA62) { goto bE7c_; eQgb4: $XK7hT = intval(Session::get('memberUserId', 0)); goto i3j1a; pvESf: View::share('_memberUserId', $XK7hT); goto oFK8E; XzNSk: return $zBA62($fn4DR); goto uDuSi; QgtHS: View::share('_memberUser', $OYXQL); goto XzNSk; m0cH2: Session::flash('_memberUser', $OYXQL); goto QgtHS; heNt0: Session::put('memberUserId', $XK7hT); goto m0cH2; bE7c_: list($vmfMO, $GSDMs) = Request::getControllerAction(); goto eQgb4; HN9_h: if ($XK7hT && !$OYXQL) { $XK7hT = 0; Session::forget('memberUserId'); } goto pvESf; oFK8E: if (empty($XK7hT)) { if (is_subclass_of($vmfMO, MemberLoginCheck::class)) { if (property_exists($vmfMO, 'memberLoginCheckIgnores') && is_array($vmfMO::$memberLoginCheckIgnores) && in_array($GSDMs, $vmfMO::$memberLoginCheckIgnores)) { } else { return Response::send(-1, null, null, modstart_web_url('login') . '?redirect=' . urlencode(Request::currentPageUrl())); } } } goto heNt0; i3j1a: $OYXQL = null; goto DEDLj; DEDLj: if ($XK7hT) { goto PzaGC; PzaGC: $OYXQL = MemberUtil::get($XK7hT); goto WxQhP; WxQhP: MemberUtil::processDefault($OYXQL); goto HhcEI; HhcEI: if ($OYXQL) { switch ($OYXQL['status']) { case MemberStatus::FORBIDDEN: $OYXQL = null; break; } } goto jcwYU; jcwYU: } goto HN9_h; uDuSi: } }
<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Web\Controller; use ModStart\App\Web\Layout\WebPage; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use ModStart\Field\AbstractField; use ModStart\Grid\Displayer\ItemOperate; use ModStart\Grid\Grid; use ModStart\Grid\GridFilter; use ModStart\ModStart; use ModStart\Module\ModuleBaseController; use ModStart\Repository\Filter\RepositoryFilter; use ModStart\Widget\Box; use ModStart\Widget\TextAction; use Module\Member\Auth\MemberUser; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberMessageStatus; class MemberMessageController extends ModuleBaseController implements MemberLoginCheck { private $api; public function __construct() { $this->api = app(\Module\Member\Api\Controller\MemberMessageController::class); } public function index(WebPage $H1G2d) { goto IJoxF; Dh0EY: $RZHSW->batchOperatePrepend('<button class="btn" data-batch-item-read><i class="iconfont icon-checked"></i> 设为已读</button>
                    <button class="btn" data-batch-read-all><i class="iconfont icon-checked"></i> 全部已读</button>'); goto f3zio; f3zio: $RZHSW->disableCUD()->canDelete(true)->canBatchDelete(true)->urlDelete(action('\\' . __CLASS__ . '@delete')); goto xNaKb; IJoxF: $RZHSW = Grid::make('member_message', function (Grid $RZHSW) { $RZHSW->datetime('created_at', '时间'); $RZHSW->richHtml('content', '内容')->hookRendering(function (AbstractField $gxoEj, $qlKQK, $mlRDG) { return "<div style='word-break:break-all;'>{$qlKQK->content}</div>"; })->listable(true)->server(modstart_web_url('member_data/ueditor')); $RZHSW->type('status', '状态')->type(MemberMessageStatus::class)->width(80); $RZHSW->repositoryFilter(function (RepositoryFilter $XM5aD) { $XM5aD->where(array('userId' => MemberUser::id())); }); $RZHSW->gridFilter(function (GridFilter $XM5aD) { $XM5aD->eq('status', '状态')->radio(MemberMessageStatus::class); }); }); goto MbzSg; OKewV: ModStart::scriptFile('module/Member/Web/Controller/memberMessage.js'); goto jDMCI; MbzSg: $RZHSW->hookItemOperateRendering(function (ItemOperate $KGMu0) { $KGMu0->getField()->width(150); if ($KGMu0->item()->status === MemberMessageStatus::UNREAD) { $KGMu0->prepend(TextAction::primary('设为已读', 'data-item-read')); } }); goto Dh0EY; TFODs: return $H1G2d->pageTitle('我的消息')->view($M1iJt)->body(new Box($RZHSW, '我的消息')); goto Yuk2J; xNaKb: if (Request::isPost()) { return $RZHSW->request(); } goto OKewV; jDMCI: list($M1iJt, $LsXtq) = $this->viewPaths('member.frame'); goto TFODs; Yuk2J: } public function delete() { return Response::sendFromGenerate($this->api->delete()); } public function read() { return Response::sendFromGenerate($this->api->read()); } public function readAll() { return Response::sendFromGenerate($this->api->readAll()); } }
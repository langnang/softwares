<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Video\Web\Controller; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use ModStart\Core\Util\PageHtmlUtil; use ModStart\Module\ModuleBaseController; use Module\Video\Util\VideoCategoryUtil; use Module\Video\Util\VideoUtil; class VideoController extends ModuleBaseController { private $api; public function __construct() { $this->api = app(\Module\Video\Api\Controller\VideoController::class); } public function home() { goto PiOxh; PiOxh: $WAiaw = Response::tryGetData($this->api->paginate()); goto htqbA; GQfnf: return $this->view('video.index', $WAiaw); goto X4Icd; htqbA: $WAiaw['pageHtml'] = PageHtmlUtil::render($WAiaw['total'], $WAiaw['pageSize'], $WAiaw['page'], '?' . Request::mergeQueries(array('page' => array('{page}')))); goto GQfnf; X4Icd: } public function index() { goto GPrc8; ITg2Y: $WAiaw['pageHtml'] = PageHtmlUtil::render($WAiaw['total'], $WAiaw['pageSize'], $WAiaw['page'], '?' . Request::mergeQueries(array('page' => array('{page}')))); goto VisZC; GPrc8: $WAiaw = Response::tryGetData($this->api->paginate()); goto ITg2Y; VisZC: return $this->view('video.list', $WAiaw); goto DTFkb; DTFkb: } public function views($wQ1uv) { goto T3IW6; DbSCb: $D_c8I['videoLatest'] = $Veacp; goto IoDvy; kIlLz: VideoUtil::visit($wQ1uv); goto X0ugM; T3IW6: $rdPEY = VideoUtil::get($wQ1uv); goto OWft0; vm4cI: $D_c8I['video'] = $rdPEY; goto DbSCb; OWft0: if (empty($rdPEY)) { return Response::send(-1, '视频不存在'); } goto kIlLz; X0ugM: $rdPEY['_category'] = ModelUtil::get('video_category', array('id' => $rdPEY['categoryId'])); goto Kat8S; IoDvy: if ($rdPEY['_category']) { goto vL1jp; I8K96: if ($D_c8I['videoNext']) { $D_c8I['videoNext'] = $D_c8I['videoNext']->toArray(); } goto rmsfF; PdqyT: if ($D_c8I['videoPrev']) { $D_c8I['videoPrev'] = $D_c8I['videoPrev']->toArray(); } goto cPu_B; vL1jp: $D_c8I['videoPrev'] = ModelUtil::model('video')->orderBy('id', 'desc')->where('id', '<', $rdPEY['id'])->first(); goto PdqyT; cPu_B: $D_c8I['videoNext'] = ModelUtil::model('video')->orderBy('id', 'asc')->where('id', '>', $rdPEY['id'])->first(); goto I8K96; rmsfF: } goto bF55Q; Kat8S: $Veacp = ModelUtil::model('video')->orderBy('id', 'desc')->limit(6)->get()->toArray(); goto dHUuJ; bF55Q: return $this->view('video.show', $D_c8I); goto BP1wR; dHUuJ: $D_c8I = array(); goto vm4cI; BP1wR: } public function search() { goto gj_cI; uiAW4: return $this->view('video.search', $WAiaw); goto POWL_; gj_cI: $WAiaw = Response::tryGetData($this->api->paginate()); goto vE5jP; vE5jP: $WAiaw['pageHtml'] = PageHtmlUtil::render($WAiaw['total'], $WAiaw['pageSize'], $WAiaw['page'], '?' . Request::mergeQueries(array('page' => array('{page}')))); goto uiAW4; POWL_: } }
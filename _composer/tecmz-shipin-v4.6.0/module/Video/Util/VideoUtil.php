<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Video\Util; use Illuminate\Support\Facades\Cache; use Illuminate\Support\Facades\DB; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Util\ArrayUtil; use ModStart\Core\Util\TimeUtil; class VideoUtil { const PREFIX = 'Video:'; public static function clearCache() { for ($VL8Aw = 0; $VL8Aw < 20; $VL8Aw++) { Cache::forget(self::PREFIX . "Latest:{$VL8Aw}"); } Cache::forget(self::PREFIX . 'All'); } public static function listLatest($r8cvh = 5) { return Cache::remember(self::PREFIX . 'Latest:' . $r8cvh, TimeUtil::MINUTE_PERIOD_DAY, function () use($r8cvh) { $VxRpT = ModelUtil::model('video')->orderBy('id', 'desc')->limit($r8cvh)->get(array('id', 'title', 'summary', 'cover', 'created_at'))->toArray(); return self::buildRecords($VxRpT); }); } public static function get($wQ1uv) { return ModelUtil::get('video', array('id' => $wQ1uv)); } public static function buildRecord($HuFy_) { goto IF_R0; IF_R0: $qlKQK = ArrayUtil::keepKeys($HuFy_, array('id', 'cover', 'title', 'updated_at', 'summary', 'categoryId', 'countPlayed', 'countUp')); goto ugZeU; Y4Bdp: if (empty($qlKQK['cover'])) { $qlKQK['cover'] = modstart_config('Video_VideoCoverDefault', ''); } goto DEp0K; DEp0K: return $qlKQK; goto s_UfS; ugZeU: $qlKQK['day'] = date('Y-m-d', strtotime($HuFy_['created_at'])); goto Y4Bdp; s_UfS: } public static function buildRecords($VxRpT) { foreach ($VxRpT as $hBBDL => $HuFy_) { $VxRpT[$hBBDL] = self::buildRecord($HuFy_); } return $VxRpT; } public static function visit($wQ1uv) { ModelUtil::update('video', $wQ1uv, array('countPlayed' => DB::raw('IFNULL(countPlayed,0)+1'))); } }
<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\PayCenter\Admin\Controller; use Illuminate\Routing\Controller; use ModStart\Admin\Layout\AdminPage; use ModStart\Core\Util\RenderUtil; use ModStart\Core\Util\TimeUtil; use ModStart\Grid\Grid; use ModStart\Grid\GridFilter; use ModStart\Repository\Filter\RepositoryFilter; use Module\PayCenter\Biz\PayCenterBiz; use Module\PayCenter\Type\PayOrderStatus; use Module\PayCenter\Type\PayType; class ReportController extends Controller { public function index(AdminPage $gETpv) { goto v1l3Y; f25O7: $rWlsS->text('body', '内容'); goto ebWwG; Iwcfq: $rWlsS->type('payType', '支付类型')->type(PayType::class); goto moLPx; moLPx: $rWlsS->currency('feeTotal', '金额'); goto f25O7; PVYLv: $rWlsS->gridFilter(function (GridFilter $qM7YH) { $qM7YH->eq('id', '支付ID'); $PFrzq = date('Y-m-d 00:00:00', time() - TimeUtil::PERIOD_MONTH); $p6Lt_ = date('Y-m-d 23:59:59', time()); $qM7YH->range('created_at', '时间')->datetime()->defaultValue(array('min' => $PFrzq, 'max' => $p6Lt_)); $qM7YH->has('payType', '类型')->checkbox(PayType::class)->autoHide(true); }); goto kfWqV; mcgO4: $rWlsS->canAdd(false)->disableItemOperate(); goto l8O4V; TKPnt: $rWlsS->gridTableTopView('module::PayCenter.View.admin.report.panel'); goto mcgO4; ivX9V: $rWlsS->id('id', '支付ID'); goto OvRYV; OvRYV: $rWlsS->select('biz', '业务')->options(PayCenterBiz::allMap()); goto FMVVJ; kfWqV: $rWlsS->gridBeforeRequestScriptView('module::PayCenter.View.admin.report.beforeScript'); goto qoBel; l8O4V: return $gETpv->pageTitle('订单对账')->body($rWlsS)->handleGrid($rWlsS); goto qmTrG; ebWwG: $rWlsS->display('updated_at', L('Updated At'))->listable(false); goto pXNfj; FMVVJ: $rWlsS->text('bizId', '业务ID'); goto u80xO; u80xO: $rWlsS->type('status', '状态')->type(PayOrderStatus::class); goto Iwcfq; pXNfj: $rWlsS->repositoryFilter(function (RepositoryFilter $qM7YH) { $qM7YH->where('status', PayOrderStatus::PAYED); }); goto PVYLv; QuCzJ: $rWlsS->display('created_at', '时间'); goto ivX9V; v1l3Y: $rWlsS = Grid::make('pay_order'); goto QuCzJ; qoBel: $rWlsS->gridRequestScript(function (Grid $rWlsS) { return RenderUtil::viewScript('module::PayCenter.View.admin.report.script', array('total' => sprintf('%.2f', $rWlsS->executeQuery()->sum('feeTotal')), 'count' => number_format($rWlsS->executeQuery()->count()))); }); goto TKPnt; qmTrG: } }
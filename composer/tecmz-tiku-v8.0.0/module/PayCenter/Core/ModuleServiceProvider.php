<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\PayCenter\Core; use Illuminate\Events\Dispatcher; use Illuminate\Support\ServiceProvider; use Latrell\Alipay\AlipayServiceProvider; use ModStart\Admin\Config\AdminMenu; use ModStart\Module\ModuleClassLoader; use Module\PayCenter\Command\PayOrderExpireCheckCommand; use Module\PayCenter\Provider\AlipayQrPayCenterProvider; use Module\PayCenter\Provider\PayCenterProvider; class ModuleServiceProvider extends ServiceProvider { public function boot(Dispatcher $KJW6D) { goto LpeHG; rbJaB: $KJW6D->subscribe(config('pay.payListener')); goto jlvEA; xQp_v: $this->publishes(array(__DIR__ . '/../Config/pay.php' => config_path('pay.php')), 'config'); goto z6CZo; vamec: ModuleClassLoader::addNamespace('Latrell\\Alipay', __DIR__ . '/../SDK/alipay/src/Latrell/Alipay'); goto dwJCZ; dwJCZ: ModuleClassLoader::addNamespace('Payment', __DIR__ . '/../SDK/helei112g-payment/src'); goto xQp_v; nb_tD: PayCenterProvider::register(AlipayQrPayCenterProvider::class); goto jz9NR; jz9NR: AdminMenu::register(function () { $bi4dx = array(array('title' => '微信支付', 'url' => '\\Module\\PayCenter\\Admin\\Controller\\ConfigController@wechat'), array('title' => '支付宝（旧）', 'url' => '\\Module\\PayCenter\\Admin\\Controller\\ConfigController@alipay'), array('title' => '支付宝', 'url' => '\\Module\\PayCenter\\Admin\\Controller\\ConfigController@alipayWeb')); foreach (PayCenterProvider::all() as $qhOVL) { $bi4dx[] = array('title' => $qhOVL->title(), 'rule' => 'PayCenterConfig', 'url' => modstart_admin_url('pay_center/provider/' . $qhOVL->name())); } $bi4dx[] = array('title' => '余额支付', 'url' => '\\Module\\PayCenter\\Admin\\Controller\\ConfigController@memberMoney'); return array(array('title' => '财务中心', 'icon' => 'cny', 'sort' => 200, 'children' => array(array('title' => '财务概况', 'url' => '\\Module\\PayCenter\\Admin\\Controller\\DashboardController@index'), array('title' => '订单对账', 'url' => '\\Module\\PayCenter\\Admin\\Controller\\ReportController@index'), array('title' => '所有订单', 'url' => '\\Module\\PayCenter\\Admin\\Controller\\PayOrderController@index'))), array('title' => L('Site Manage'), 'icon' => 'cog', 'sort' => 400, 'children' => array(array('title' => '支付设置', 'children' => $bi4dx)))); }); goto vamec; z6CZo: $this->app->register(AlipayServiceProvider::class); goto rbJaB; jlvEA: try { if (modstart_config('payAlipayOn', false)) { config(array('pay.alipay' => array('partnerId' => modstart_config()->getWithEnv('payAlipayPartnerId'), 'sellerId' => modstart_config()->getWithEnv('payAlipaySellerId'), 'key' => modstart_config()->getWithEnv('payAlipayKey')))); } } catch (\Exception $knlzD) { } goto Sjoto; LpeHG: $this->commands(array(PayOrderExpireCheckCommand::class)); goto nb_tD; Sjoto: } public function register() { $this->mergeConfigFrom(__DIR__ . '/../Config/pay.php', 'pay'); } }
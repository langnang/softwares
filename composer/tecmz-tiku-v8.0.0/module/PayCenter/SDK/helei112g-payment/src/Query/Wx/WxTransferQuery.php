<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Query\Wx; use Payment\Common\PayException; use Payment\Common\Weixin\Data\Query\TransferQueryData; use Payment\Common\Weixin\WxBaseStrategy; use Payment\Config; use Payment\Utils\DataParser; class WxTransferQuery extends WxBaseStrategy { protected $reqUrl = 'https://api.mch.weixin.qq.com/{debug}/mmpaymkttransfers/gettransferinfo'; public function getBuildDataClass() { return TransferQueryData::class; } protected function retData(array $GeXSC) { goto SpqDm; l_w9r: return $this->createBackData($GeXSC); goto H2xED; PVVqT: if ($GeXSC['return_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['return_msg'], 'channel' => Config::WX_TRANSFER); } goto sm0sW; sm0sW: if ($GeXSC['result_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['err_code_des'], 'channel' => Config::WX_TRANSFER); } goto l_w9r; SpqDm: if ($this->config->returnRaw) { $GeXSC['channel'] = Config::WX_TRANSFER; return $GeXSC; } goto PVVqT; H2xED: } protected function createBackData(array $GeXSC) { goto SjOra; zDgK3: return $eypYa; goto R7oTq; LS5Jw: $eypYa = array('is_success' => 'T', 'response' => array('trans_no' => $GeXSC['partner_trade_no'], 'transaction_id' => $GeXSC['detail_id'], 'status' => strtolower($GeXSC['status']), 'reason' => $GeXSC['reason'], 'openid' => $GeXSC['openid'], 'payee_name' => $GeXSC['transfer_name'], 'amount' => $F3tdn, 'pay_date' => $GeXSC['transfer_time'], 'desc' => $GeXSC['desc'], 'channel' => Config::WX_TRANSFER)); goto zDgK3; SjOra: $F3tdn = bcdiv($GeXSC['payment_amount'], 100, 2); goto LS5Jw; R7oTq: } public function handle(array $GeXSC) { goto Xl9Cp; ZL4W5: $this->reqData->setSign(); goto Vjl1F; Y2Wcy: return $this->retData($BEdDh); goto f4ra6; VUwUS: try { $this->reqData = new $FjIu5($this->config, $GeXSC); } catch (PayException $knlzD) { throw $knlzD; } goto ZL4W5; SkIFC: try { $BEdDh = $this->sendReq($Fc2BM); } catch (PayException $knlzD) { throw $knlzD; } goto Y2Wcy; Vjl1F: $Fc2BM = DataParser::toXml($this->reqData->getData()); goto SkIFC; Xl9Cp: $FjIu5 = $this->getBuildDataClass(); goto VUwUS; f4ra6: } }
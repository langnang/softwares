<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Query\Wx; use Payment\Common\PayException; use Payment\Common\Weixin\Data\Query\RedQueryData; use Payment\Common\Weixin\WxBaseStrategy; use Payment\Config; use Payment\Utils\DataParser; class WxRedQuery extends WxBaseStrategy { protected $reqUrl = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/gethbinfo'; public function getBuildDataClass() { return RedQueryData::class; } protected function retData(array $GeXSC) { goto pl62i; A1Uro: if ($GeXSC['result_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['err_code_des'], 'channel' => Config::WX_RED); } goto iIBXf; pl62i: if ($this->config->returnRaw) { $GeXSC['channel'] = Config::WX_RED; return $GeXSC; } goto rJ4yb; rJ4yb: if ($GeXSC['return_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['return_msg'], 'channel' => Config::WX_RED); } goto A1Uro; iIBXf: return $this->createBackData($GeXSC); goto UlDl_; UlDl_: } protected function createBackData(array $GeXSC) { goto H2gCX; H2gCX: $F3tdn = bcdiv($GeXSC['payment_amount'], 100, 2); goto Asjno; Asjno: $eypYa = array('is_success' => 'T', 'response' => array('trans_no' => $GeXSC['partner_trade_no'], 'transaction_id' => $GeXSC['detail_id'], 'status' => strtolower($GeXSC['status']), 'reason' => $GeXSC['reason'], 'openid' => $GeXSC['openid'], 'payee_name' => $GeXSC['transfer_name'], 'amount' => $F3tdn, 'pay_date' => $GeXSC['transfer_time'], 'desc' => $GeXSC['desc'], 'channel' => Config::WX_RED)); goto jhZZs; jhZZs: return $eypYa; goto eUvd6; eUvd6: } public function handle(array $GeXSC) { goto Bddc3; ua147: $Fc2BM = DataParser::toXml($this->reqData->getData()); goto MT8M8; ECv9s: try { $this->reqData = new $FjIu5($this->config, $GeXSC); } catch (PayException $knlzD) { throw $knlzD; } goto N8Mpe; Bddc3: $FjIu5 = $this->getBuildDataClass(); goto ECv9s; MT8M8: try { $BEdDh = $this->sendReq($Fc2BM); } catch (PayException $knlzD) { throw $knlzD; } goto e4ULo; e4ULo: return $this->retData($BEdDh); goto h2xoy; N8Mpe: $this->reqData->setSign(); goto ua147; h2xoy: } }
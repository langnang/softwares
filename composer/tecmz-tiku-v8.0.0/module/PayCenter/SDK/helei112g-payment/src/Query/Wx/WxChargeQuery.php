<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Payment\Query\Wx; use Payment\Common\Weixin\Data\Query\ChargeQueryData; use Payment\Common\Weixin\WxBaseStrategy; use Payment\Common\WxConfig; use Payment\Config; use Payment\Utils\ArrayUtil; class WxChargeQuery extends WxBaseStrategy { protected $reqUrl = 'https://api.mch.weixin.qq.com/{debug}/pay/orderquery'; public function getBuildDataClass() { return ChargeQueryData::class; } protected function retData(array $GeXSC) { goto XgPrH; SbCYj: if ($GeXSC['result_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['err_code_des'], 'channel' => Config::WX_CHARGE); } goto wTvnB; XgPrH: if ($this->config->returnRaw) { $GeXSC['channel'] = Config::WX_CHARGE; return $GeXSC; } goto X8a79; X8a79: if ($GeXSC['return_code'] != 'SUCCESS') { return $eypYa = array('is_success' => 'F', 'error' => $GeXSC['return_msg'], 'channel' => Config::WX_CHARGE); } goto SbCYj; wTvnB: return $this->createBackData($GeXSC); goto paJ1J; paJ1J: } protected function createBackData(array $GeXSC) { goto RURpG; VeJ6n: return ArrayUtil::paraFilter($eypYa); goto q1twC; VHGC2: $eypYa = array('is_success' => 'T', 'response' => array('amount' => $pfV4Z, 'channel' => Config::WX_CHARGE, 'order_no' => $GeXSC['out_trade_no'], 'buyer_id' => $GeXSC['openid'], 'trade_state' => strtolower($GeXSC['trade_state']), 'transaction_id' => $GeXSC['transaction_id'], 'time_end' => date('Y-m-d H:i:s', strtotime($GeXSC['time_end'])), 'return_param' => $GeXSC['attach'], 'terminal_id' => $GeXSC['device_info'], 'trade_type' => $GeXSC['trade_type'], 'bank_type' => $GeXSC['bank_type'], 'trade_state_desc' => isset($GeXSC['trade_state_desc']) ? $GeXSC['trade_state_desc'] : '交易成功')); goto VeJ6n; RURpG: $pfV4Z = bcdiv($GeXSC['total_fee'], 100, 2); goto VHGC2; q1twC: } }
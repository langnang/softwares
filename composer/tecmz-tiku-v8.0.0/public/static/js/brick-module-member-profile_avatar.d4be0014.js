(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["brick-module-member-profile_avatar"],{"013c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("c975"),i("a9e3"),i("ac1f"),i("5319"),i("acd8");var a={type:"scrolldone",target:{id:"",offsetLeft:0,offsetTop:0,dataset:{}},currentTarget:{id:"",offsetLeft:0,offsetTop:0,dataset:{}},detail:{}},o={props:{backgroundTextStyle:{type:String,default:"dark",validator:function(t){return-1!==["dark","light"].indexOf(t)}},backgroundColor:{type:String,default:"#ffffff"},backgroundColorTop:{type:String,default:"#ffffff"},backgroundColorBottom:{type:String,default:"#ffffff"},scrollTop:{type:String,default:""},scrollDuration:{type:Number,default:300},pageStyle:{type:String,default:""},enablePullDownRefresh:{type:[Boolean,String],default:!1},rootFontSize:{type:String,default:""}},created:function(){var t=this,e=getCurrentPages()[0];this.$pageVm=e.$vm||e,uni.onWindowResize((function(e){t.$emit("resize",e)})),this.$pageVm.$on("hook:onPageScroll",(function(e){t.$emit("scroll",e)})),this.$watch("backgroundTextStyle",(function(){t.setBackgroundTextStyle()})),this.$watch((function(){return[t.rootFontSize,t.pageStyle]}),(function(){t.setPageMeta()})),this.$watch((function(){return[t.backgroundColor,t.backgroundColorTop,t.backgroundColorBottom]}),(function(){t.setBackgroundColor()})),this.$watch((function(){return[t.scrollTop,t.scrollDuration]}),(function(){t.pageScrollTo()}))},beforeMount:function(){this.setBackgroundColor(),(this.rootFontSize||this.pageStyle)&&this.setPageMeta(),this.backgroundTextStyle&&this.setBackgroundTextStyle(),this.scrollTop&&this.pageScrollTo()},methods:{setPullDownRefresh:function(t,e){t.setStyle({pullToRefresh:{support:e,style:"Android"===plus.os.name?"circle":"default"}})},setPageMeta:function(){uni.setPageMeta({pageStyle:this.pageStyle,rootFontSize:this.rootFontSize})},setBackgroundTextStyle:function(){},setBackgroundColor:function(){},pageScrollTo:function(){var t=this,e=String(this.scrollTop);if(-1!==e.indexOf("rpx")&&(e=uni.upx2px(e.replace("rpx",""))),e=parseFloat(e),!isNaN(e)){var i=function i(o){o.scrollTop===e&&(t.$pageVm.$off("hook:onPageScroll",i),t.$emit("scrolldone",a))};uni.pageScrollTo({scrollTop:e,duration:this.scrollDuration,success:function(){t.$pageVm.$on("hook:onPageScroll",i)}})}}}};e.default=o},"13cd":function(t,e,i){"use strict";i.r(e);var a=i("50b0"),o=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=o.a},"1bff":function(t,e,i){"use strict";i.r(e);var a=i("a79a"),o=i("13cd");for(var n in o)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(n);i("9676");var r,s=i("f0c5"),c=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,"1d1a2d31",null,!1,a["a"],r);e["default"]=c.exports},"3cc6":function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return a}));var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-canvas",{staticClass:"image-canvas",style:{top:t.cropperTop,height:t.cropperHeight},attrs:{"canvas-id":"image-canvas",id:"image-canvas","disable-scroll":"false"}}),i("v-uni-canvas",{staticClass:"crop-layout-canvas",style:{top:t.cropperTop,height:t.cropperHeight},attrs:{"canvas-id":"crop-layout-canvas",id:"crop-layout-canvas","disable-scroll":"false"},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.onTouchStart.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.onTouchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.onTouchEnd.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"corp-layout-wrapper",style:{display:t.styleDisplay}},[i("v-uni-view",{staticClass:"corp-layout"},[i("v-uni-view",{staticClass:"btn-wrapper"},[i("v-uni-view",{style:{width:t.buttonWidth},attrs:{"hover-class":"hover"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doSelectImage()}}},[i("v-uni-text",[t._v("重选")])],1),i("v-uni-view",{style:{width:t.buttonWidth},attrs:{"hover-class":"hover"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doClose.apply(void 0,arguments)}}},[i("v-uni-text",[t._v("关闭")])],1),i("v-uni-view",{style:{width:t.buttonWidth,display:t.buttonDisplay},attrs:{"hover-class":"hover"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doRotate.apply(void 0,arguments)}}},[i("v-uni-text",[t._v("旋转")])],1),i("v-uni-view",{style:{width:t.buttonWidth},attrs:{"hover-class":"hover"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doSave.apply(void 0,arguments)}}},[i("v-uni-text",[t._v("保存")])],1)],1)],1)],1)],1)},n=[]},4088:function(t,e,i){var a=i("4bad");e=a(!1),e.push([t.i,".image-canvas[data-v-7da5dd76]{display:-webkit-box;display:-webkit-flex;display:flex;position:fixed!important;background:#000;left:0;z-index:100000;width:100%}.my-avatar[data-v-7da5dd76]{width:%?150?%;height:%?150?%;border-radius:100%}.crop-layout-canvas[data-v-7da5dd76]{display:-webkit-box;display:-webkit-flex;display:flex;position:fixed!important;left:0;z-index:100001;width:100%}.corp-layout-wrapper[data-v-7da5dd76]{height:50px;position:fixed!important;box-sizing:border-box;border:1px solid #f1f1f1;background:#fff;width:100%;left:0;bottom:0;z-index:100009;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.corp-layout[data-v-7da5dd76]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;padding:%?10?% %?20?%;width:100%;height:100%;box-sizing:border-box;-webkit-align-self:center;align-self:center}.btn-wrapper[data-v-7da5dd76]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;height:50px;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.btn-wrapper uni-view[data-v-7da5dd76]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;font-size:16px;color:#333;border:1px solid #f1f1f1;border-radius:6%}.hover[data-v-7da5dd76]{background:#f1f1f1;border-radius:6%}.clr-wrapper[data-v-7da5dd76]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-flex:1;-webkit-flex-grow:1;flex-grow:1}.clr-wrapper uni-view[data-v-7da5dd76]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;font-size:16px;color:#333;border:1px solid #f1f1f1;border-radius:6%}.image-color-slider[data-v-7da5dd76]{-webkit-box-flex:1;-webkit-flex-grow:1;flex-grow:1}",""]),t.exports=e},4803:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("a9e3"),i("c975"),i("e25e");var a=50,o={name:"ImageCropper",data:function(){return{cropperHeight:"0px",styleDisplay:"none",cropperTop:"-10000px",cropStyle:{},buttonWidth:"24%",buttonDisplay:"flex",hasImage:!1,imagePx:0,imagePy:0,imageWidth:0,imageHeight:0,imageWidthRaw:0,imageHeightRaw:0,cropSaveWidthInPx:0,cropSaveHeightInPx:0}},props:{cropWidth:{type:String,default:"350rpx"},cropHeight:{type:String,default:"350rpx"},cropSaveWidth:{type:String,default:"300rpx"},cropSaveHeight:{type:String,default:"300rpx"},minScale:{type:Number,default:.3},maxScale:{type:Number,default:4},canScale:{type:Boolean,default:!0},canRotate:{type:Boolean,default:!0},stretch:{type:String,default:""},lock:{type:String,default:""},quality:{type:Number,default:.9},hasTabBar:{type:Boolean,default:!1}},created:function(){var t=this;this.canvasImage=uni.createCanvasContext("image-canvas",this),this.canvasCropLayout=uni.createCanvasContext("crop-layout-canvas",this),this.hasTabBar?(this.moreHeight=0,this.doWindowResize()):uni.showTabBar({complete:function(e){t.moreHeight="showTabBar:ok"===e.errMsg?50:0,t.doWindowResize()}})},methods:{doWindowResize:function(){var t=uni.getSystemInfoSync();this.platform=t.platform,this.pixelRatio=t.pixelRatio,this.windowWidth=t.windowWidth,this.drawTop=t.windowTop,this.windowHeight=t.windowHeight+t.windowBottom,this.cropperHeight=this.windowHeight-a+"px",this.pxRatio=this.windowWidth/750,this.cropSaveWidth&&(this.cropSaveWidthInPx=this.cropSaveWidth.indexOf("rpx")>=0?parseInt(this.cropSaveWidth)*this.pxRatio:parseInt(this.cropSaveWidth)),this.cropSaveHeight&&(this.cropSaveHeightInPx=this.cropSaveHeight.indexOf("rpx")>=0?parseInt(this.cropSaveHeight)*this.pxRatio:parseInt(this.cropSaveHeight)),"flex"===this.styleDisplay&&this.doDrawInit(!0)},doSelectImage:function(){var t=this;this.fSelecting||(this.fSelecting=!0,setTimeout((function(){t.fSelecting=!1}),500),uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){uni.showLoading({mask:!0});var i=t.imgPath=e.tempFilePaths[0];uni.getImageInfo({src:i,success:function(e){if(t.imageWidthRaw=e.width,t.imageHeightRaw=e.height,t.path=i,!t.hasImage){var o=t.cropStyle||{};if(!t.cropWidth||!t.cropHeight)return void uni.showModal({title:"裁剪框的宽或高没有设置",showCancel:!1});var n=t.cropWidth.indexOf("rpx")>=0?parseInt(t.cropWidth)*t.pxRatio:parseInt(t.cropWidth),r=t.cropHeight.indexOf("rpx")>=0?parseInt(t.cropHeight)*t.pxRatio:parseInt(t.cropHeight);o.width=n+"px",o.height=r+"px",o.top=(t.windowHeight-r-a)/2+"px",o.left=(t.windowWidth-n)/2+"px",t.cropStyle=o}t.hasTabBar?t.doDrawInit(!0):uni.hideTabBar({complete:function(){t.doDrawInit(!0)}})},fail:function(){uni.showToast({title:"error3",duration:2e3})},complete:function(){uni.hideLoading()}})}}))},doSave:function(){var t=this;if(!this.fUploading){this.fUploading=!0,setTimeout((function(){t.fUploading=!1}),1e3);var e=this.cropStyle,i=parseInt(e.left),a=parseInt(e.top),o=parseInt(e.width),n=parseInt(e.height),r=this.cropSaveWidthInPx||o,s=this.cropSaveHeightInPx||n;r=o,s=n,uni.showLoading({mask:!0}),this.styleDisplay="none",this.cropperTop="-10000px",this.hasImage=!1,uni.canvasToTempFilePath({x:i,y:a,width:o,height:n,destWidth:r,destHeight:s,canvasId:"image-canvas",fileType:"png",quality:this.quality,success:function(e){var i=t;i.$emit("save",{data:e.tempFilePath})},fail:function(t){uni.showToast({title:"error",duration:2e3})},complete:function(){uni.hideLoading(),t.hasTabBar||uni.showTabBar()}},this)}},doDrawInit:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.imageWidthRaw,o=this.imageHeightRaw,n=i/o,r=this.windowWidth-40,s=this.windowHeight-a-80,c=(this.pixelRatio,parseInt(this.cropStyle.width)),l=parseInt(this.cropStyle.height);switch(this.fixWidth=0,this.fixHeight=0,this.lckWidth=0,this.lckHeight=0,this.stretch){case"x":this.fixWidth=1;break;case"y":this.fixHeight=1;break;case"long":n>1?this.fixWidth=1:this.fixHeight=1;break;case"short":n>1?this.fixHeight=1:this.fixWidth=1;break;case"longSel":c>l?this.fixWidth=1:this.fixHeight=1;break;case"shortSel":c>l?this.fixHeight=1:this.fixWidth=1;break}switch(this.lock){case"x":this.lckWidth=1;break;case"y":this.lckHeight=1;break;case"long":n>1?this.lckWidth=1:this.lckHeight=1;break;case"short":n>1?this.lckHeight=1:this.lckWidth=1;break;case"longSel":c>l?this.lckWidth=1:this.lckHeight=1;break;case"shortSel":c>l?this.lckHeight=1:this.lckWidth=1;break}this.fixWidth?(r=c,s=r/n):this.fixHeight?(s=l,r=s*n):n<1?o<s?(r=i,s=o):(s=s,r=s*n):i<r?(r=i,s=o):(r=r,s=r/n),this.scaleSize=1,this.rotateDeg=0,this.imagePx=(this.windowWidth-r)/2,this.imagePy=(this.windowHeight-s-a)/2,this.imageWidth=r,this.imageHeight=s;var d=this.cropStyle,h=parseInt(d.left),u=parseInt(d.top),f=parseInt(d.width),p=parseInt(d.height),g=(this.canvas,this.canvasImage),v=this.canvasCropLayout;v.setLineWidth(3),v.setStrokeStyle("grey"),v.setGlobalAlpha(.4),v.setFillStyle("black"),v.strokeRect(h,u,f,p),v.fillRect(0,0,this.windowWidth,u),v.fillRect(0,u,h,p),v.fillRect(0,u+p,this.windowWidth,this.windowHeight-p-u-a),v.fillRect(h+f,u,this.windowWidth-f-h,p),v.setStrokeStyle("red"),v.moveTo(h+20,u),v.lineTo(h,u),v.lineTo(h,u+20),v.moveTo(h+f-20,u),v.lineTo(h+f,u),v.lineTo(h+f,u+20),v.moveTo(h+20,u+p),v.lineTo(h,u+p),v.lineTo(h,u+p-20),v.moveTo(h+f-20,u+p),v.lineTo(h+f,u+p),v.lineTo(h+f,u+p-20),v.stroke(),v.draw(!1,(function(){e&&(t.styleDisplay="flex",t.cropperTop=t.drawTop+"px",g.setFillStyle("black"),t.doDrawImage())}))},doDrawImage:function(){var t=Date.now();if(!(t-this.drawTm<20)){this.drawTm=t;var e=this.canvasImage;e.fillRect(0,0,this.windowWidth,this.windowHeight-a),e.translate(this.imagePx+this.imageWidth/2,this.imagePy+this.imageHeight/2),e.scale(this.scaleSize,this.scaleSize),e.rotate(this.rotateDeg*Math.PI/180),e.drawImage(this.imgPath,-this.imageWidth/2,-this.imageHeight/2,this.imageWidth,this.imageHeight),e.draw(!1)}},doClose:function(){this.styleDisplay="none",this.cropperTop="-10000px",this.hasImage=!1,this.hasTabBar||uni.showTabBar()},doRotate:function(){this.rotateDeg+=90-this.rotateDeg%90,this.doDrawImage()},onTouchStart:function(t){var e=t.touches,i=e[0],a=e[1];if(this.touch0=i,this.touch1=a,a){var o=a.x-i.x,n=a.y-i.y;this.fgDistance=Math.sqrt(o*o+n*n)}},onTouchMove:function(t){var e=t.touches,i=e[0],a=e[1];if(a){var o=a.x-i.x,n=a.y-i.y,r=Math.sqrt(o*o+n*n),s=.005*(r-this.fgDistance),c=this.scaleSize+s;do{if(!this.canScale)break;if(c<this.minScale)break;if(c>this.maxScale)break;this.scaleSize=c}while(0);this.fgDistance=r,a.x!==i.x&&this.canRotate&&(o=(this.touch1.y-this.touch0.y)/(this.touch1.x-this.touch0.x),n=(a.y-i.y)/(a.x-i.x),this.rotateDeg+=180*Math.atan((n-o)/(1+o*n))/Math.PI,this.touch0=i,this.touch1=a),this.doDrawImage()}else if(this.touch0){var l=i.x-this.touch0.x,d=i.y-this.touch0.y,h=this.imagePx+l,u=this.imagePy+d;Math.abs(l)<100&&!this.lckWidth&&(this.imagePx=h),Math.abs(d)<100&&!this.lckHeight&&(this.imagePy=u),this.touch0=i,this.doDrawImage()}},onTouchEnd:function(t){var e=t.touches,i=e&&e[0];e&&e[1];i?this.touch0=i:(this.touch0=null,this.touch1=null)}}};e.default=o},"50b0":function(t,e,i){"use strict";var a=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(i("dbc6")),n=i("51d9"),r=i("2f62"),s={components:{ImageCropper:o.default},computed:(0,r.mapState)({user:function(t){return t.user.user}}),data:function(){return{loading:!1}},onShow:function(){this.$starter.boot()},methods:{doSave:function(t){var e=this;this.loading=!0,this.$api.post("member_profile/avatar",{type:"cropper",avatar:t.data},(function(t){e.loading=!1,n.EventBus.$emit("UpdateApp"),e.$dialog.tipSuccess("修改成功")}),(function(t){e.loading=!1}))}}};e.default=s},"58d4":function(t,e,i){"use strict";i.r(e);var a=i("4803"),o=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=o.a},"6d42":function(t,e,i){"use strict";i.r(e);var a=i("d630"),o=i("8f28");for(var n in o)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(n);var r,s=i("f0c5"),c=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);e["default"]=c.exports},"8f28":function(t,e,i){"use strict";i.r(e);var a=i("013c"),o=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=o.a},9676:function(t,e,i){"use strict";var a=i("f196"),o=i.n(a);o.a},"994f":function(t,e,i){var a=i("4088");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var o=i("4f06").default;o("4d81f641",a,!0,{sourceMap:!1,shadowMode:!1})},a79a:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return a}));var a={pageMeta:i("6d42").default},o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("page-meta",{attrs:{"root-font-size":"20px"}}),i("v-uni-view",[i("page-header",{attrs:{title:"修改头像"}}),i("v-uni-view",{staticClass:"pb-member-profile-avatar"},[i("v-uni-view",{staticClass:"padding"},[i("v-uni-view",{staticClass:"cu-avatar round avatar-preview",style:{"background-image":"url("+t.user.avatarBig+")"}})],1),i("v-uni-view",{staticClass:"padding flex flex-direction"},[i("v-uni-button",{staticClass:"btn btn-primary btn-lg",attrs:{disabled:t.loading,loading:t.loading},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.$refs.avatar.doSelectImage()}}},[i("v-uni-text",{staticClass:"iconfont"},[t._v("")]),t._v("选择图片")],1)],1),i("ImageCropper",{ref:"avatar",on:{save:function(e){arguments[0]=e=t.$handleEvent(e),t.doSave.apply(void 0,arguments)}}})],1)],1)],1)},n=[]},d630:function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return a}));var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticStyle:{display:"none"}},[t._t("default")],2)},n=[]},dbc6:function(t,e,i){"use strict";i.r(e);var a=i("3cc6"),o=i("58d4");for(var n in o)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(n);i("f408");var r,s=i("f0c5"),c=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,"7da5dd76",null,!1,a["a"],r);e["default"]=c.exports},f196:function(t,e,i){var a=i("f64f");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var o=i("4f06").default;o("1538cc78",a,!0,{sourceMap:!1,shadowMode:!1})},f408:function(t,e,i){"use strict";var a=i("994f"),o=i.n(a);o.a},f64f:function(t,e,i){var a=i("4bad");e=a(!1),e.push([t.i,".pb-member-profile-avatar[data-v-1d1a2d31]{text-align:center}.pb-member-profile-avatar .avatar-preview[data-v-1d1a2d31]{width:%?300?%;height:%?300?%}",""]),t.exports=e}}]);
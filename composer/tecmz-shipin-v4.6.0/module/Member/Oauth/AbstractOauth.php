<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Oauth; use ModStart\Core\Input\Response; use Module\Member\Util\MemberUtil; abstract class AbstractOauth { public function hasRender() { return true; } public function isSupport() { return true; } public function color() { return null; } public function title() { return $this->name(); } public function oauthKey() { return $this->name(); } public abstract function name(); public abstract function render(); public function bindRender() { return null; } public abstract function processRedirect($EeGOj); public abstract function processLogin($EeGOj); public function processTryLogin($EeGOj) { goto LSyIW; LSyIW: $cSXlN = $EeGOj['userInfo']; goto drl0R; m_xwa: $XK7hT = MemberUtil::getIdByOauthAndCheck($this->name(), $IpkBq); goto wVy9D; wVy9D: if ($XK7hT) { return Response::generateSuccessData(array('memberUserId' => $XK7hT)); } goto bxYj0; drl0R: $IpkBq = $cSXlN['openid']; goto m_xwa; bxYj0: return Response::generateSuccessData(array('memberUserId' => 0)); goto FqUv7; FqUv7: } public function processBindToUser($EeGOj) { goto DQVQt; VNDe8: $zoCJb = array(); goto sS_Tb; VVwsR: $wQ1uv = MemberUtil::getIdByOauthAndCheck($this->name(), $cSXlN['openid']); goto lMP4U; DQVQt: $XK7hT = $EeGOj['memberUserId']; goto TU8HI; sS_Tb: if (!empty($cSXlN['username'])) { $zoCJb['infoUsername'] = $cSXlN['username']; } goto szLUz; sVebr: MemberUtil::putOauth($XK7hT, $this->name(), $cSXlN['openid'], $zoCJb); goto mLHa2; mLHa2: return Response::generateSuccess(); goto Yzzq7; TU8HI: $cSXlN = $EeGOj['userInfo']; goto VVwsR; lMP4U: if ($wQ1uv && $XK7hT != $wQ1uv) { MemberUtil::forgetOauth($this->name(), $cSXlN['openid']); } goto VNDe8; szLUz: if (!empty($cSXlN['avatar'])) { $zoCJb['infoAvatar'] = $cSXlN['avatar']; } goto sVebr; Yzzq7: } }
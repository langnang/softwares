<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; use Module\Vendor\Support\ResponseCodes; class ApiAuthMiddleware { public function handle($fn4DR, \Closure $zBA62) { goto wDU5n; vzK72: Session::flash('_memberUser', $OYXQL); goto SFfEB; wDU5n: list($vmfMO, $GSDMs) = Request::getControllerAction(); goto h1CvO; ODVQ3: if (empty($XK7hT)) { if (is_subclass_of($vmfMO, MemberLoginCheck::class)) { if (property_exists($vmfMO, 'memberLoginCheckIgnores') && is_array($vmfMO::$memberLoginCheckIgnores) && in_array($GSDMs, $vmfMO::$memberLoginCheckIgnores)) { } else { return Response::json(ResponseCodes::LOGIN_REQUIRED, '请登录', null, modstart_web_url('login', array('redirect' => Request::currentPageUrl()))); } } } goto Ib8xe; h1CvO: $XK7hT = intval(Session::get('memberUserId', 0)); goto xmdpC; Ib8xe: Session::put('memberUserId', $XK7hT); goto vzK72; SFfEB: return $zBA62($fn4DR); goto e2FBH; QPImf: if ($XK7hT && !$OYXQL) { $XK7hT = 0; Session::forget('memberUserId'); } goto ODVQ3; xmdpC: $OYXQL = null; goto Vg6m7; Vg6m7: if ($XK7hT) { goto I2vYA; qiG53: MemberUtil::processDefault($OYXQL); goto ZE49S; ZE49S: if ($OYXQL) { switch ($OYXQL['status']) { case MemberStatus::FORBIDDEN: $OYXQL = null; break; } if ($OYXQL['isDeleted']) { $OYXQL = null; } } goto Y4Y7i; I2vYA: $OYXQL = MemberUtil::get($XK7hT); goto qiG53; Y4Y7i: } goto QPImf; e2FBH: } }